# Vue3

- 准备写一些有意思的东西

## 1. 实现一个 mini-reactivity 模块

- 数据劫持、数据响应

## 2. 对比两个vdom属性，判断是否相同

- 虚拟dom属性对比 isSomeNode

**总结：Vue3重写源码、更好的支持ts、组合式API**

## 3. vue3 diff 相比之前做了哪些优化

- diff算法优化（用空间换时间）

首尾游标，静态节点提升、补丁标记、动态属性记录、缓存事件、缓存块block

1. patchFlag 动态内容记录，加快patch过程
2. dynamicChildren、dynamicProps记录动态子节点和属性，对比时有效减少遍历操作
3. shapeFlag 标记组件形态是否时组件/template
4. type 表示节点类型

## 4. 为什么vue2不能做以上diff优化

- vue2 diff 采用双端指针的方式，处理动态节点的同时也会对静态节点进行比较，导致性能较低。但是其缺点是对于静态节点（即在编译时就已经确定的节点）的处理效率较低，因为它会重复对比静态节点。
- vue3 diff 可以更好地处理静态节点，通过静态标记和编译时优化，避免了对静态节点的重复比较和 DOM 操作，从而提高了渲染性能。但是其缺点是对于动态节点的处理效率相对较低。
  1. 首先对比新旧节点的标记，如果不同，则直接替换整个节点。标记包括节点类型、标签名、key 值等信息。
  2. 然后对比新旧节点的静态子节点，如果相同，则跳过比较，如果不同，则替换整个静态子节点。静态子节点是指在编译时就已经确定的节点，不会发生变化。
  3. 然后对比新旧节点的动态子节点，采用双端指针的方式进行比较，根据 key 值进行匹配。动态子节点是指在运行时才能确定的节点，可能会发生变化。
  4. 最后对比新旧节点的新增、删除、移动等节点，进行 DOM 操作。如果是新增节点，则需要将新增节点插入到 DOM 树中；如果是被删除的节点，则需要将被删除的节点从 DOM 树中移除；如果是移动的节点，则需要将移动的节点移动到正确的位置。

基于 Proxy 的响应式系统相比 Vue 2 的 Object.defineProperty 的实现更加高效和灵活，能够更好地处理数组和嵌套对象的响应式更新。而静态提升则通过将模板编译为渲染函数，在编译时就对模板进行分析和优化，避免了运行时的不必要计算，从而提高了渲染性能。

## 5. 计划基于mini-reactivity做单测

- 实践TDD
- 实践单测
